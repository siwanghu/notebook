<!-- TOC -->

- [Seata](#seata)
    - [分布式事务](#分布式事务)
    - [2PC](#2pc)
        - [2PC流程](#2pc流程)
        - [2PC缺陷](#2pc缺陷)
    - [AT模式](#at模式)

<!-- /TOC -->
# Seata  
+ Seata开源分布式事务框架，致力于提供高性能的分布式事务服务  
+ Seata提供AT、TCC、SAGA事务模式，为用户打造简单易用的分布式事务解决方案  
## 分布式事务  
![](./pic/tra.PNG)  
## 2PC  
+ 两阶段事务提交协议，由协调者和参与者共同完成  
  
| **角色** | **XA概念** | **作用** |  
| ------ | ------ | ------ |  
| 协调者 | 事务管理器 | 协调各个参与者，对分布式事务进行提交或回滚 |  
| 参与者 | 资源管理器 | 分布式集群中的节点，分布式事务参与者 |  
### 2PC流程
+ 第一阶段：准备阶段  
> 1. 协调者向所有的参与者询问，并开始等待各参与者的响应  
>  
> 2. 参与者执行本地事务操作,并将Undo和Redo信息记入事务日志中，但不提交  
>  
> 3. 参与者成功执行了事务操作，反馈协调者Yes响应；否则返回No响应给协调者，表示事务不可以执行提交  
>  
![准备阶段](./pic/2pc_1.png) 
+ 第二阶段：提交阶段  
> 1. 协调者在收到所有参与者的事务执行成功响应后，向所有的参与者发送全局事务提交  
  
![提交过程](./pic/2pc_2.png)  
> 2. 协调者收到参与者的事务执行失败响应（或超时未收到参与者的任何响应），向所有的参与者发送全局事务回滚  
  
![回滚过程](./pic/2pc_3.png)  
### 2PC缺陷  
+ 同步阻塞：所有参与节点都是事务阻塞型，事务执行期间参与者占有数据库资源时，其他第三方访问数据库资源都将处于阻塞状态  
+ 单点问题：全流程依赖协调者的协调，一旦协调者发生故障，参与者会一直阻塞下去，直到等待协调者重新上线后才能继续工作  
+ 容错性不好：协调者只能依靠其自身的超时机制，判断是否需要中断事务，任意一个节点的失败都会导致整个事务的回滚  
+ 数据不一致：协调者在尚未发送完所有提交请求之前自身发生了崩溃或存在参与者因为网络故障没有收到提交请求，将导致数据的不一致性  
## AT模式  
